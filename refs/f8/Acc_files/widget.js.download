var G=Object.defineProperty,F=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var I=(t,e,o)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,v=(t,e)=>{for(var o in e||(e={}))S.call(e,o)&&I(t,o,e[o]);if(h)for(var o of h(e))L.call(e,o)&&I(t,o,e[o]);return t},y=(t,e)=>F(t,K(e));var M=(t,e)=>{var o={};for(var s in t)S.call(t,s)&&e.indexOf(s)<0&&(o[s]=t[s]);if(t!=null&&h)for(var s of h(t))e.indexOf(s)<0&&L.call(t,s)&&(o[s]=t[s]);return o};var T=(t,e,o)=>(I(t,typeof e!="symbol"?e+"":e,o),o);var u=(t,e,o)=>new Promise((s,a)=>{var c=l=>{try{d(o.next(l))}catch(E){a(E)}},_=l=>{try{d(o.throw(l))}catch(E){a(E)}},d=l=>l.done?s(l.value):Promise.resolve(l.value).then(c,_);d((o=o.apply(t,e)).next())});import{a5 as N,I as i,i as m,_ as r,Z as $,a6 as j,g as q,a7 as D,a8 as C}from"./a48b95d27/embed-widgets-loader.bf55e84a.js";import{T as k,s as B,r as Y}from"./a48b95d27/floating-widget-loader.f2022725.js";const z=()=>{const t=new CustomEvent("tolstoyWidgetReady");window.dispatchEvent(t)},Bt=()=>{const t=new CustomEvent(k);window.dispatchEvent(t)},w={PDP_CAROUSEL:"pdp-carousel",VIDEO_PAGE:"video-page"},p={HEADER:"header",HEADER_AND_BOTTOM_NAVBAR:"header-and-bottom-navbar",CUSTOM_SCREEN:"custom-screen",CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:"custom-screen-and-bottom-navbar"},P=t=>document.documentElement.style.setProperty("height",`${t}px`,"important"),Q=()=>navigator.userAgent.toLowerCase().includes("android"),Z=t=>{const e=window.screen.availHeight,o=window.Tapcart.variables.device.windowHeight;switch(t){case p.HEADER:return o;case p.HEADER_AND_BOTTOM_NAVBAR:return o;case p.CUSTOM_SCREEN:return e-100;case p.CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:return e-184;default:return o||e}},J=t=>{const e=window.screen.availHeight,o=window.Tapcart.variables.device.windowHeight;switch(t){case p.HEADER:return o;case p.HEADER_AND_BOTTOM_NAVBAR:return o-75;case p.CUSTOM_SCREEN:return e-90;case p.CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:return e-175;default:return o||e}},X=t=>Q()?Z(t):J(t),tt=(t,e)=>{const o=X(e.navType);P(o)},et=t=>`
    <style>
      .tolstoy-video-page iframe {
        display: block !important;
      }
    </style>
    <tolstoy-video-page
      id="tolstoy-tv-container"
      class="tolstoy-video-page"
      data-publish-id="${t}"
    ></tolstoy-video-page>
  `,ot=(t={})=>{const{height:e=490}=t;let o=0;const s=setInterval(function(){o++;const a=document.querySelector(".tolstoy-carousel-container"),c=document.querySelector(".tolstoy-carousel");a&&c?(c.style.display="block",P(e),clearInterval(s)):o>=50&&clearInterval(s)},200)},st=(t,e)=>{P(0),ot(e)},it=t=>{var o,s,a;const e=(a=(s=(o=window==null?void 0:window.Tapcart)==null?void 0:o.variables)==null?void 0:s.product)==null?void 0:a.id;return`
    <style>
      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
        font-family: Helvetica;
      }
      
      .tolstoy-carousel-wrapper {
        padding-bottom: 25px;
      }
      
      .tolstoy-carousel iframe {
        display: block !important;
      }
    </style>
    <div class="tolstoy-carousel-wrapper">
      <tolstoy-carousel
        class="tolstoy-carousel"
        data-publish-id="${t}"
        style="display: none"
        ${e?`data-product-id="${e}"`:""}
      ></tolstoy-carousel>
    </div>
  `},rt=(t,e)=>u(void 0,null,function*(){switch(e.blockType){case w.PDP_CAROUSEL:{st(t,e);break}case w.VIDEO_PAGE:{tt(t,e);break}}}),nt=`
<style>
#tapcart-dashboard-fallback-ui {
  padding: 8px;
  line-height: 20px;
  border: 1px solid black;
}
</style>
<div id="tapcart-dashboard-fallback-ui">
Tolstoy widget will appear here.
<br/>
Click on preview in top right to see widget.
</div>
`,at=()=>u(void 0,null,function*(){const t=document.querySelectorAll("tolstoy-block");if(t.length!==0){if(N()){for(const e of Array.from(t))e.outerHTML=nt;return}for(const e of Array.from(t)){const{publishId:o,blockType:s,navType:a,height:c}=e.dataset||{},_={blockType:s,navType:a,height:c};let d="";switch(s){case w.PDP_CAROUSEL:{d=it(o);break}case w.VIDEO_PAGE:{d=et(o);break}}d&&(e.outerHTML=d,rt(e,_))}}}),ct=[i.urlChange],dt=t=>{switch(t.data.eventName){case i.urlChange:return B();default:return null}},lt=["googlebot","google-inspectiontool","google-structured-data-testing-tool","storebot-google","google"],ut=["gptbot","chatgpt","openai","gemini","grok","xai","xai-crawler","xai-search","oai","gptbot","perplexitybot","anthropic","perplexity","claude"],_t=["(+https://whatis.contentkingapp.com)","Shopify-Observe-Synthetic-Checks","https://naver.me/spd","HeadlessChrome","(+http://www.facebook.com/externalhit_uatext.php)","Bytespider","bot"],pt=()=>{const t=window.navigator.userAgent.toLowerCase();return lt.some(e=>t.includes(e))},Et=()=>_t.some(t=>window.navigator.userAgent.includes(t)),gt=()=>{const t=window.navigator.userAgent.toLowerCase();return pt()?!0:ut.some(e=>t.includes(e))},mt=[i.addToCartError,i.addToCartSuccess,i.addToCartSoldOut,i.isRebuyAppInstalled,i.isAfterpayAppInstalled,i.openRebuyCart,i.returnProductsMetafields,i.acceptCookiePolicy,i.rejectCookiePolicy,i.productCardClickSubscribed,i.isTapcart,i.urlLocaleUpdate,i.loginWithMultipassUrlResponse,i.cartDataResponse,i.cartItemQuantityChangeSuccess,i.cartItemQuantityChangeError,i.productRecommendationsResponse,i.productUpdateResponse,i.isNonBaseCurrency,i.eventListenersInitialized],A={},f={},b={},R=[];class g{constructor(){T(this,"eventHandler",({data:e={}})=>{const{modalId:o,eventName:s}=e;if(o)switch(s){case i.addToCart:case i.openRebuyCart:case i.openKendoModal:case i.getProductsMetafields:case i.productCardClick:case i.loginWithMultipassUrlRequest:case i.cartItemQuantityChange:case i.cartDataRequest:case i.productRecommendationsRequest:case i.requestProductsUpdate:case i.moveToUrl:case i.showFeedProductModal:case i.reportModalOpen:case i.reportModalClose:case k:return this.postInternalMessage({modalId:o,data:e});case i.modalMessagingReady:return this.postInternalMessage({modalId:o,data:e}),this.handleModalMessagingReady({modalId:o});case i.toggleFeedCloseButton:return this.postInternalMessage({modalId:o,data:e});default:return null}});T(this,"internalEventHandler",({data:e})=>{this.postMessageToModal(e)});T(this,"initInternalMessagingSubscriptions",()=>{m.subscribeMultipleEvents({eventNames:mt,callback:this.internalEventHandler})});if(g.instance)return g.instance;g.instance=this}registerIframe({modalId:e,modalIframe:o}){A[e]=o}postInternalMessage({modalId:e,data:o}){delete o.modalId;const s=m.postMessage(o);b[s]=e}handleModalMessagingReady({modalId:e}){f[e]=!0;const o=A[e];for(const s of R){const{transmissionId:a}=s,c=b[a];(!c||c===e)&&this.postMessageToIframe({iframe:o,message:s})}}postMessageToIframe({iframe:e,message:o}){var s;(s=e.contentWindow)==null||s.postMessage(o,"*")}postMessageToAllIframes({message:e}){R.push(e);for(const[o,s]of Object.entries(A))f[o]&&this.postMessageToIframe({iframe:s,message:e})}postMessageToModal(e){const l=e,{transmissionId:o,shouldEndTransmission:s=!0}=l,a=M(l,["transmissionId","shouldEndTransmission"]),c=b[o];if(!c)return this.postMessageToAllIframes({message:a});if(!f[c]){R.push(e);return}const d=A[c];this.postMessageToIframe({iframe:d,message:a}),s&&delete b[o]}init(){this.initInternalMessagingSubscriptions(),window.addEventListener("message",this.eventHandler)}}const O=new g;Object.freeze(O);const ht=50,Tt="8b32dacc-8f1d-4cce-b641-9f60e88f9414",At=()=>{typeof window!="undefined"&&Promise.all([r(()=>import("./a48b95d27/embed-widgets.utils.0a5c7f8b.js").then(t=>t.u),[]),r(()=>import("./a48b95d27/product-gallery-video-loader.5a08c368.js"),[]),r(()=>import("./a48b95d27/embed-widgets.ccaf6353.js"),[]),r(()=>import("./a48b95d27/floating-widget-loader.f2022725.js").then(t=>t.o),[]),r(()=>import("./a48b95d27/video-widget-loader.2d4fa99c.js").then(t=>t.V),[]),r(()=>import("./a48b95d27/external-messaging.665d0e48.js").then(t=>t.b),[]),r(()=>import("./a48b95d27/external-messaging.665d0e48.js").then(t=>t.c),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.S),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.U),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.C),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.R),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.K),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.T),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.A),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.a),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.P),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.O),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.b),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(t=>t.W),[])])},bt=()=>{var e,o;const t=((e=document.currentScript)==null?void 0:e.src)||((o=import.meta)==null?void 0:o.url);if(t!=null&&t.includes("/we/widget.js")){D({src:`https://${C}/wes/widget.js`,container:document.head,attributes:{type:"module"}});return}D({src:`https://${C}/ws/widget.js`,container:document.head})},wt=()=>!!document.body,It=()=>{try{return window.self!==window.top}catch(t){return!0}},vt=()=>It()&&window.location.host==="theordinary.com",H=()=>u(void 0,null,function*(){var t,e,o,s,a,c;try{if(window.tolstoyWidget||vt())return;if(Et()&&!gt()){console.debug("Bot user");return}if(!wt()){setTimeout(H,ht);return}if($()&&(yield at()),N())return;if(j("td")==="true"&&!((o=(e=(t=document.currentScript)==null?void 0:t.src)==null?void 0:e.includes)!=null&&o.call(e,"/ws/widget.js"))&&!((c=(a=(s=import.meta)==null?void 0:s.url)==null?void 0:a.includes)!=null&&c.call(a,"/wes/widget.js"))){bt();return}Y(),Pt(),St(),yield Promise.all([Lt(),Mt(),Dt()]),Ct(),B(),yield yt(),yield Promise.all([Rt(),Ot(),ft()]),z()}catch(_){console.log("error",_)}}),yt=()=>u(void 0,null,function*(){const{default:t}=yield r(()=>import("./a48b95d27/embed-widgets-loader.bf55e84a.js").then(e=>e.c1),[]);return t.init()});let V;const ft=()=>u(void 0,null,function*(){const{default:t}=yield r(()=>import("./a48b95d27/embed-widgets-loader.bf55e84a.js").then(e=>e.c2),[]);return V=new t,V.init()}),Rt=t=>u(void 0,null,function*(){const{default:e}=yield r(()=>import("./a48b95d27/floating-widget-loader.f2022725.js").then(s=>s.o),[]);return new e(t).init()}),Ot=()=>u(void 0,null,function*(){const{default:t}=yield r(()=>import("./a48b95d27/video-widget-loader.2d4fa99c.js").then(o=>o.V),[]);return new t().init()}),Pt=()=>(m.init(),m),St=()=>(O.init(),O),Lt=()=>u(void 0,null,function*(){const{default:t}=yield r(()=>import("./a48b95d27/external-messaging.665d0e48.js").then(s=>s.c),[]);t.init();const{subscribe:e,unsubscribe:o}=t;return window.tolstoyWidget=y(v({},window.tolstoyWidget),{subscribe:e,unsubscribe:o}),t}),Mt=()=>u(void 0,null,function*(){const{default:t}=yield r(()=>import("./a48b95d27/external-messaging.665d0e48.js").then(c=>c.b),[]),{postMessage:e,closePlayer:o,identify:s,changeEmail:a}=t;return window.tolstoyWidget=y(v({},window.tolstoyWidget),{postMessage:e,closePlayer:o,identify:s,changeEmail:a}),t}),Dt=()=>u(void 0,null,function*(){const[{default:t},{default:e},{default:o},{default:s},{default:a},{default:c},{default:_},{default:d},{default:l},{default:E},{default:U},{default:W}]=yield Promise.all([r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.S),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.U),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.C),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.R),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.K),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.T),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.A),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.a),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.P),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.O),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.b),[]),r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(n=>n.W),[])]);if(t.init(),e.init(),o.init(),s.init(),a.init(),c.init(),_.init(),d.init(),l.init(),E.init(),U.init(),W.init(),q()===Tt){const{default:n}=yield r(()=>import("./a48b95d27/subscribers.c84f3b9a.js").then(x=>x.c),[]);n.init()}}),Ct=()=>{m.subscribeMultipleEvents({eventNames:ct,callback:dt})};At();H();export{z as a,O as i,Bt as t};
