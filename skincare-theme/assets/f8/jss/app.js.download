document.addEventListener("DOMContentLoaded", function () {
  // if (Shopify.designMode) {
  //   console.log("Theme Editor is active");
  //   document.querySelector("#jobly-preview-div").style.display = "block";
  //   document.querySelector("#jobly-main-div").style.display = "none";
  // } else {
  //   console.log("Theme Editor is not active");
  //   document.querySelector("#jobly-main-div").style.display = "block";
  //   document.querySelector("#jobly-preview-div").style.display = "none";
  // }
  const frameSrc = document.querySelector("#joblyFrame").src;
  const frameSrcUrl = new URL(frameSrc);
  const shop = frameSrcUrl.searchParams.get("shop");
  if (!shop.includes("myshopify.com")) {
    frameSrcUrl.searchParams.set("shop", Shopify.shop);
    document.querySelector("#joblyFrame").src = frameSrcUrl;
  }

});

window.addEventListener("message", (e) => {
  console.log("data is coming---------", e.data);
  if (e.data.app === "jobly") {
    if (e.data.type === "height") {
      // if (document.querySelector("#joblyFrame").offsetHeight < e.data.height) {
      document.querySelector("#joblyFrame").style.height = e.data.height + 200 + "px";
      // }
    }

    if (e.data.type === "redirect") {
      window.location.href = e.data.url;
    }

    if (e.data.type === "job_schema") {
      const script_tag = document.createElement("script");
      script_tag.setAttribute("type", "application/ld+json");
      script_tag.innerHTML = JSON.stringify(e.data.schema);
      document.querySelector("body").appendChild(script_tag);
    }
  }
});
