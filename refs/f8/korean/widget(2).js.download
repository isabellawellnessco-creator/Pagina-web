var de=Object.defineProperty,ue=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var q=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O=(e,t)=>{for(var n in t||(t={}))pe.call(t,n)&&q(e,n,t[n]);if(Z)for(var n of Z(t))Se.call(t,n)&&q(e,n,t[n]);return e},v=(e,t)=>ue(e,ge(t));var N=(e,t,n)=>q(e,typeof t!="symbol"?t+"":t,n);var C=(e,t,n)=>new Promise((i,l)=>{var o=c=>{try{u(n.next(c))}catch(r){l(r)}},d=c=>{try{u(n.throw(c))}catch(r){l(r)}},u=c=>c.done?i(c.value):Promise.resolve(c.value).then(o,d);u((n=n.apply(e,t)).next())});import{i as he,g as Ie,a as _e,l as w,b as B,_ as S,W as K,c as D,D as F,d as be}from"./a87087021/widget-loader.DAQy60C1.js";import{s as ye,A as oe,P as T,T as a,O as P,l as k,W as U,S as Ae}from"./a87087021/search-bar-widget-settings.jazglfcm.js";import{q as ae}from"./a87087021/vendor-misc.DS4z9ZJk.js";import{g as ie,P as L,L as V,W as M}from"./a87087021/events.constants.DL-T4Byd.js";import"./a87087021/vendor-preact.CIIGgvJN.js";const me={PRODUCT_TILE:"tolstoy-product-tile"},Je="./styles/product-tile.css",Ze="w-full",Ee="tolstoy-collection-page-tile",et="./styles/collection-page-tile.css",tt={display:"flex",width:"100%",height:"100%",position:"relative"},fe="tolstoy-video-page",nt="video-page-root",ot={width:"100%",height:"100%",position:"relative",overflow:"hidden"},at={HEADER:"header",HEADER_AND_BOTTOM_NAVBAR:"header-and-bottom-navbar",CUSTOM_SCREEN:"custom-screen",CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:"custom-screen-and-bottom-navbar"},Ce=(e,t)=>C(void 0,null,function*(){var o,d;const i=ye()&&he()?Ie():_e(),l=new URLSearchParams;l.set("productId",e),l.set("appKey",t);try{const u=yield fetch(`${i}/settings/widget/get-product-gallery-config?${l}`);w({windowShopify:(o=window.Shopify)==null?void 0:o.shop});const c=[...document.querySelectorAll("script[data-shop]")].map(A=>{var h;return(h=A==null?void 0:A.dataset)==null?void 0:h.shop}).find(Boolean);w({appDataShop:c});const r=c||((d=window.Shopify)==null?void 0:d.shop),p=yield u.json();return p.projects&&(p.projects=p.projects.filter(A=>A.appUrl===r)),p}catch(u){return B(u,"Error getting collection page tile config"),null}}),Te=()=>{var t;const e=window.Shopify;return(t=e==null?void 0:e.theme)==null?void 0:t.theme_store_id},Pe="#tolstoy-video-preview",we="thumbnail.0000000000",Oe="_ai-preview_",ve=".product__media, .product-single__thumbnails, .gallery, .product-gallery, .slider, .carousel, section.product",Be=e=>[...ve.split(",").map(t=>t.trim()).filter(Boolean),"body"].map(t=>`${t} :has(${e})`).join(","),Le=e=>{var t,n,i;return((t=e==null?void 0:e.alt)==null?void 0:t.includes(Pe))||((n=e==null?void 0:e.src)==null?void 0:n.includes(we))||((i=e==null?void 0:e.src)==null?void 0:i.includes(Oe))},it=(e,t,n)=>{const i=t.split(",").flatMap(o=>[o,`${o} img`]).join(",");return[...n?ae(i):document.querySelectorAll(i)].some(o=>o.contains(e))};function rt(e,t,n){const i=n||Be(e),l=document.querySelector(i);return l?Array.from(t?ae(e,l):l.querySelectorAll(e)):[]}const De=()=>{const e=l=>{const o=document.querySelectorAll(`script[${l}]`);for(const d of o){const u=d.getAttribute(l);if(u&&u.trim()!=="")return u}return null},t=e("data-product-id"),n=e("data-app-key"),i=e("data-product-gallery-projects");return{productId:t,appKey:n,productGalleryProjects:i}},ee=(e,t)=>C(void 0,null,function*(){if(e){const{initThumbnailAnchorImageDetection:i}=yield S(()=>C(void 0,null,function*(){const{initThumbnailAnchorImageDetection:l}=yield import("./a87087021/thumbnail-anchor-image-detection.utils.VPPNZh4W.js");return{initThumbnailAnchorImageDetection:l}}),[]);return i(t)}const{initFallbackImageDetection:n}=yield S(()=>C(void 0,null,function*(){const{initFallbackImageDetection:i}=yield import("./a87087021/fallback-image-detection.utils.DNCiXHkk.js");return{initFallbackImageDetection:i}}),[]);return n(t)}),Re=()=>C(void 0,null,function*(){var e,t,n,i,l;try{let o;w("init product gallery");const{productId:d,appKey:u,productGalleryProjects:c}=De();if(!d||!u)return;try{const s=JSON.parse(c);if(w({productGalleryProjects:s}),!(s!=null&&s.length))return}catch(s){B({error:s.message});return}if(o=yield Ce(d,u),!((e=o==null?void 0:o.product)!=null&&e.images)||!((t=o==null?void 0:o.projects)!=null&&t.length)||!((n=o==null?void 0:o.vodAssets)!=null&&n.length)&&!Object.keys((i=o==null?void 0:o.vodAssets)!=null?i:{}).length)return;const r=o.product.images.map(s=>s.src),p=Te();if(w("themeId",p),p){const{themeContainerClasses:s}=yield S(()=>C(void 0,null,function*(){const{themeContainerClasses:f}=yield import("./a87087021/theme-classes-extractor.BVNtrPL4.js");return{themeContainerClasses:f}}),[]),g=s[p];if(g){const{variantSelector:f,mainGallerySelector:E,thumbnailSelector:b}=g;w("config from theme",{themeId:p,variantSelector:f,mainGallerySelector:E,thumbnailSelector:b});const m=((l=o.projects[0])==null?void 0:l.playerSettings)||{};if(m.useNativePlayer)return;m.galleryImageSelector=m.galleryImageSelector||E,m.galleryThumbnailSelector=m.galleryThumbnailSelector||b}}const A=new URLSearchParams(location.search).get("test-gallery");if(A){const{renderTestGalleryIfNeeded:s}=yield S(()=>C(void 0,null,function*(){const{renderTestGalleryIfNeeded:g}=yield import("./a87087021/render-test-gallery.Bayxz2kr.js");return{renderTestGalleryIfNeeded:g}}),[]);s(A,r)}const h=o.product.images.some(Le);w({hasThumbnailAnchorImage:h});let _=()=>{};const I=!Array.isArray(o==null?void 0:o.vodAssets)&&Object.keys(o.vodAssets).length>0;if(w({hasConfigVariants:I,vodAssets:o.vodAssets}),I){const s=()=>C(void 0,null,function*(){try{const E=new URLSearchParams(location.search).get("variant"),b=document.querySelector('form[action="/cart/add"] [name="id"]'),m=parseInt(E||(b==null?void 0:b.value)||"NaN",10);if(w({message:"Current variant:",value:m}),_(),o!=null&&o.vodAssets[m]){const y=v(O({},o),{variant:m,vodAssets:o==null?void 0:o.vodAssets[m],appKey:u});w({clientConfig:y}),_=yield ee(h,y)}else _=()=>{}}catch(E){B({error:E})}});let g=window.location.search;const f=new MutationObserver(()=>{window.location.search!==g&&(g=window.location.search,s())});return f.observe(document,{subtree:!0,childList:!0}),s(),()=>{f.disconnect(),_()}}else return yield ee(h,v(O({},o),{appKey:u}))}catch(o){B(o,"Error initializing product gallery video")}}),H="shop-assistant-container",$={flexGrow:1,width:"100%"};class ke{constructor(){N(this,"getChatBubbleConfig",t=>C(this,null,function*(){return yield oe.onyouService.chatBubble.getChatBubbleSettings.query(t)}))}}const Ue=new ke,X={isPreviewSite:()=>T.isPreviewSite(),updatePreviewPage:e=>{if(T.isPreviewSite()&&e){if(e.thumbnailUrl){const t=document.querySelectorAll(".product__media img");if(t.length>0)for(const n of t)n.src=e.thumbnailUrl,n.srcset=e.thumbnailUrl}if(e.title){const t=document.querySelectorAll(".product__title h1");if(t.length>0)for(const n of t)n.textContent=e.title}}}},j="chat-bubble-root",We=e=>C(void 0,null,function*(){var t,n,i,l;try{let o=!1,d=e||document.getElementById(j);yield a.init(d==null?void 0:d.dataset,!!e);const u=a.customerId;if(!a.appUrl){P.log("ChatBubbleController: Invalid app url",a.appUrl);return}if(!a.chatBubbleEnabled){P.log("ChatBubbleController: Chat bubble is disabled.");return}const c=yield Ue.getChatBubbleConfig({appUrl:a.appUrl,appKey:a.appKey,productId:a.productId||void 0});!c.enabled&&!T.isPreviewSite()&&(P.log("Chat bubble is disabled. Widget not paid"),o=!0);const{compatibilityVersion:r,shoppingAssistantConfig:p,settings:A}=c;if(r!=="v2"){console.log("ChatBubbleController init failed. Version is not v2..",c);return}const{displayOnPages:h,bannedCollectionIds:_,includeTemplates:I}=A,s=ie({productId:a.productId,collectionId:a.collectionId});if(T.isPreviewSite()||(s===L.collection&&(_!=null&&_.includes(a.collectionId||""))&&(P.log(`ChatBubbleController Widget hidden - collection banned: ${a.collectionId}`),o=!0),s===L.home||s===L.product||s===L.collection?h&&h.length>0&&h.includes(s)||(P.log(`ChatBubbleController Widget hidden - page type not allowed: ${s}, displayOnPages: ${h}`),o=!0):I&&I.length>0&&!I.includes(a.templateName)&&(P.log(`ChatBubbleController Widget hidden - template not included: ${a.templateName}, includeTemplates: ${I}`),o=!0)),!c.settings){P.log("ChatBubbleController settings are missing");return}k(c.shoppingAssistantConfig.brandSettings.brandHeaderFont),k((t=c.shoppingAssistantConfig.chatModalSettings)==null?void 0:t.fontStyle),console.timeLog("ChatBubbleController init","font loaded"),T.isPreviewSite()&&X.updatePreviewPage(c.product);let g=document.getElementById(j);g||(g=document.createElement("div"),g.id=j,g.style.zIndex="2147483647",g.style.position="relative",document.body.appendChild(g));const[{default:f},{default:E},{default:b}]=yield Promise.all([S(()=>import("./a87087021/chat-bubble-app.CBWNmI_V.js"),[]),S(()=>import("./a87087021/render.utils.Difzk0UH.js").then(G=>G.a),[]),S(()=>import("./a87087021/shop-assistant.y0Si0ncO.js"),[])]),{autoOpenChatBubble:m,urlParams:y}=U.handleWidgetCallbackUrl();m&&U.cleanupCallbackUrl();const W={appKey:a.appKey,appUrl:a.appUrl,pageProductId:a.productId,pageCollectionId:a.collectionId,agentImage:p.agentSettings.agentImage,brandLogo:((n=p==null?void 0:p.brandSettings)==null?void 0:n.brandLogo)||"",hidePoweredBy:p==null?void 0:p.hidePoweredBy,settings:A,preloadedStyles:b,skills:p.skills,autoOpen:m,urlParams:y,element:g,customerId:u,chatModalSettings:p.chatModalSettings,assistantInitialMessage:(l=(i=p.chatModalSettings)==null?void 0:i.assistantInitialMessage)!=null?l:"",hide:o};yield E(f,v(O({},W),{element:g,hasStyledComponents:!0,widgetKey:K.SHOP_ASSISTANT_BUBBLE,containerClasses:H,containerStyles:$,preloadedStyles:b})),g.setAttribute("data-status",D.SUCCESS)}catch(o){console.error("Error initializing Shop Assistant:",o),B("Error initializing Shop Assistant",o);const d=document.getElementById(j);d&&d.setAttribute("data-status",D.FAILED)}}),Y="search-bar-root",z=e=>C(void 0,null,function*(){var t,n,i,l;console.log("[SearchBar Debug] Controller init - entry",{hasElement:!!e,elementDataset:e==null?void 0:e.dataset,widgetType:e==null?void 0:e.dataset.widgetType,isInlineCandidate:!!(e&&e.dataset.widgetType==="inline")}),console.time("SearchBarWidgetController init");try{let o=e||document.getElementById(Y);const d=(o==null?void 0:o.dataset.widget)==="search-bar-on-player",u=(o==null?void 0:o.dataset.widget)==="search-bar-on-stories";yield a.init(o==null?void 0:o.dataset,!!e);const c=a.customerId;if(console.timeLog("SearchBarWidgetController init","TolstoySettings initialized"),!d&&!u&&a.aiShopperWidget&&a.aiShopperWidget!=="search-bar"){console.log("[SearchBar Debug] Early return: AI shopper widget is not search-bar",{aiShopperWidget:a.aiShopperWidget});return}if(!d&&!u&&!a.searchBarWidgetEnabled&&!T.isPreviewSite()){console.log("[SearchBar Debug] Early return: Search bar is disabled",{searchBarWidgetEnabled:a.searchBarWidgetEnabled,isPreviewSite:T.isPreviewSite()}),P.log("SearchBarWidgetController: Search bar is disabled");return}if(!a.appUrl){console.log("[SearchBar Debug] Early return: Invalid app url",{appUrl:a.appUrl}),P.log("SearchBarWidgetController: Invalid app url",a.appUrl);return}const r=yield Ae.getSearchBarConfig({appKey:a.appKey,appUrl:a.appUrl,productId:a.productId||void 0});if(console.log("[SearchBar Debug] Got search bar config",{enabled:r==null?void 0:r.enabled,compatibilityVersion:r==null?void 0:r.compatibilityVersion,enableInline:(t=r==null?void 0:r.settings)==null?void 0:t.enableInline,enableFloating:(n=r==null?void 0:r.settings)==null?void 0:n.enableFloating}),!d&&!u&&!(r!=null&&r.enabled)&&!T.isPreviewSite()){console.log("[SearchBar Debug] Early return: Widget not enabled/paid",{enabled:r==null?void 0:r.enabled,isPreviewSite:T.isPreviewSite()}),P.log("Search bar is disabled. Widget not paid");return}const{compatibilityVersion:p,chatBubbleSettings:A}=r;if(p!=="v2"){console.log("SearchBarWidgetController init failed. Version is not v2..",r);return}const{displayOnPages:h,bannedCollectionIds:_,includeTemplates:I}=r.settings,s=ie({productId:a.productId,collectionId:a.collectionId});if(!d&&!u&&!T.isPreviewSite()){if(console.log("[SearchBar Debug] Checking visibility rules",{currentPageType:s,displayOnPages:h,bannedCollectionIds:_,includeTemplates:I,collectionId:a.collectionId,templateName:a.templateName}),s===L.collection&&(_==null?void 0:_.includes(a.collectionId||""))){console.log("[SearchBar Debug] Early return: Collection is banned",{collectionId:a.collectionId,bannedCollectionIds:_}),P.log(`SearchBarWidgetController Widget hidden - collection banned: ${a.collectionId}`);return}if(s===L.home||s===L.product||s===L.collection){const y=h&&h.length>0&&h.includes(s);if(!y){console.log("[SearchBar Debug] Early return: Page type not allowed",{currentPageType:s,displayOnPages:h,shouldShowBasedOnPageType:y}),P.log(`SearchBarWidgetController Widget hidden - page type not allowed: ${s}, displayOnPages: ${h}`);return}}else{const y=I&&I.length>0&&!I.includes(a.templateName);if(y){console.log("[SearchBar Debug] Early return: Template not included",{templateName:a.templateName,includeTemplates:I,shouldHideBasedOnTemplate:y}),P.log(`SearchBarWidgetController Widget hidden - template not included: ${a.templateName}, includeTemplates: ${I}`);return}}console.log("[SearchBar Debug] Visibility checks passed")}if(console.timeLog("SearchBarWidgetController init","seeItOnYouWidgetSettings fetched"),k(r.settings.fontFamily),console.timeLog("SearchBarWidgetController init","font loaded"),T.isPreviewSite()&&X.updatePreviewPage(r.product),!r.settings){P.log("Search bar settings are missing");return}const g=!!(e&&(o==null?void 0:o.dataset.widgetType)==="inline"),f=((i=r.settings.enableFloating)!=null?i:!0)&&!d&&!u,E=e&&(((l=r.settings.enableInline)!=null?l:!1)||d||u);if(console.log("[SearchBar Debug] Instance creation decision",{hasElement:!!e,isInlineFromTheme:g,shouldCreateFloating:f,shouldCreateInline:E,enableFloating:r.settings.enableFloating,enableInline:r.settings.enableInline,isInPlayerSearch:d,isInStoriesSearch:u}),e&&E&&(console.log("[SearchBar Debug] Creating inline instance",{element:e,isInlineFromTheme:g,isInPlayerSearch:d,isInStoriesSearch:u}),yield te(e,{searchBarConfig:r,currentPageType:s,isFloatingSearchBar:!1,isInlineFromTheme:g,isInPlayerSearch:d,isInStoriesSearch:u,customerId:c,chatBubbleSettings:A})),f&&(!e||g)){console.log("[SearchBar Debug] Creating floating instance",{hasElement:!!e,isInlineFromTheme:g});let b=document.getElementById(Y);b||(b=document.createElement("div"),b.id=Y,document.body.appendChild(b)),yield te(b,{searchBarConfig:r,currentPageType:s,isFloatingSearchBar:!0,isInlineFromTheme:!1,isInPlayerSearch:d,isInStoriesSearch:u,customerId:c,chatBubbleSettings:A})}console.log("[SearchBar Debug] Controller init complete")}catch(o){console.error("Error initializing Search Bar:",o),B("Error initializing Search Bar",o);const d=e!=null?e:document.getElementById(Y);d&&d.setAttribute("data-status",D.FAILED)}}),te=(e,t)=>C(void 0,null,function*(){var g,f,E,b,m,y,W,G;const{searchBarConfig:n,currentPageType:i,isFloatingSearchBar:l,isInlineFromTheme:o,isInPlayerSearch:d,isInStoriesSearch:u,customerId:c,chatBubbleSettings:r}=t;console.log("[SearchBar Debug] createSearchBarInstance called",{containerId:e.id,containerDataset:e.dataset,isFloatingSearchBar:l,isInlineFromTheme:o,isInPlayerSearch:d,isInStoriesSearch:u});const[{default:p},{default:A},{default:h}]=yield Promise.all([S(()=>import("./a87087021/search-bar-widget-app.BHy1mzuh.js"),[]),S(()=>import("./a87087021/render.utils.Difzk0UH.js").then(J=>J.a),[]),S(()=>import("./a87087021/search-bar.BOYZx4CD.js"),[])]);console.timeLog("SearchBarWidgetController init","components loaded");const{autoOpenSearchBar:_,urlParams:I}=U.handleWidgetCallbackUrl();_&&U.cleanupCallbackUrl();const s={appKey:a.appKey,appUrl:a.appUrl,pageProductId:a.productId,pageCollectionId:a.collectionId,isFloatingSearchBar:l,isInlineFromTheme:o,settings:n.settings,agentImage:(f=(g=n.shoppingAssistantConfig)==null?void 0:g.agentSettings)==null?void 0:f.agentImage,brandLogo:((b=(E=n.shoppingAssistantConfig)==null?void 0:E.brandSettings)==null?void 0:b.brandLogo)||"",hidePoweredBy:a.isSearchBarOnPlayer||a.isSearchBarOnStories||((m=n.shoppingAssistantConfig)==null?void 0:m.hidePoweredBy),preloadedStyles:h,skills:(y=n.shoppingAssistantConfig)==null?void 0:y.skills,autoOpen:_,urlParams:I,element:e,isSearchBarOnPlayer:a.isSearchBarOnPlayer,isSearchBarOnStories:a.isSearchBarOnStories,videoId:(W=a.videoId)!=null?W:null,chatModalSettings:(G=n.shoppingAssistantConfig)==null?void 0:G.chatModalSettings,customerId:c,chatBubbleSettings:r};console.log("[SearchBar Debug] Props for SearchBarWidgetApp",{isFloatingSearchBar:s.isFloatingSearchBar,isInlineFromTheme:s.isInlineFromTheme,isSearchBarOnPlayer:s.isSearchBarOnPlayer,isSearchBarOnStories:s.isSearchBarOnStories,enableInline:s.settings.enableInline,enableFloating:s.settings.enableFloating}),yield A(p,v(O({},s),{hasStyledComponents:!0,widgetKey:K.SEARCH_BAR,containerClasses:H,containerStyles:$,preloadedStyles:h})),e.setAttribute("data-status",D.SUCCESS)}),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:z,init:z},Symbol.toStringTag,{value:"Module"})),Ve=(e,t)=>e.getAttribute(t),st=e=>{const t=e.attributes,n={};for(const i of t)n[i.name]=e.getAttribute(i.name);return n};function lt(e){if(!e||!e.includes("//"))return null;const t=new URL(e!=null&&e.startsWith("//")?`https:${e}`:e).pathname.split("/").pop();return(t==null?void 0:t.split(".").slice(0,-1).join("."))||""}class Me{getAskAISettings(t){return C(this,null,function*(){return yield oe.onyouService.askAI.getAskAISettings.query(t)})}}const re=new Me,x="tolstoy-ask-ai-icon-auto",Ge=[".header__search",".site-header__search",".header-search","[data-header-search]",".header__icon--search",".header-icons__search"],se=e=>{var l;if(document.getElementById(x))return null;let n=null;if(e&&(n=document.querySelector(e)),!n){for(const o of Ge)if(n=document.querySelector(o),n)break}if(!n)return console.log("AskAIController: No target element found for icon injection"),null;const i=document.createElement("div");return i.id=x,i.className="tolstoy-ask-ai-icon",i.style.display="inline-flex",i.style.alignItems="center",(l=n.parentNode)==null||l.insertBefore(i,n.nextSibling),i},Fe=e=>C(void 0,null,function*(){console.log("AskAIController init");try{yield a.init();const t=a.appKey,n=a.appUrl,i=a.productId,l=a.collectionId,o=a.customerId,d=Ve(e,F.PRODUCT_ID)||T.getSettings().productId||i;if(!n||!t||a.aiShopperWidget&&a.aiShopperWidget!=="ask-ai"){console.log("AskAIController init failed - missing appUrl or appKey");return}const u=yield re.getAskAISettings({appKey:t,appUrl:n,productId:d||""}),{settings:c,shoppingAssistantConfig:r,enabled:p,product:A,compatibilityVersion:h}=u,{chatModalSettings:_}=r;if(h!=="v2"){console.log("AskAIController init failed. Version is not v2..",u);return}if(T.isPreviewSite()&&X.updatePreviewPage(A),!p&&!T.isPreviewSite()){console.log("Widget is not enabled.");return}if(!c||!r||!_){console.log("AskAIController init failed. No settings or shopping assistant config.");return}const{includeTemplates:I}=c,s=I==null?void 0:I.includes(a.templateName);if(I&&I.length>0&&!s&&!T.isPreviewSite()){console.log(`Ask AI hidden for template: ${a.templateName}, configured templates: ${c.includeTemplates}`);return}k(c.font),k(_.fontStyle);const[{default:g},{default:f},{default:E}]=yield Promise.all([S(()=>import("./a87087021/ask-ai-widget.D5EBFxEn.js"),[]),S(()=>import("./a87087021/render.utils.Difzk0UH.js").then(y=>y.a),[]),S(()=>import("./a87087021/ask-ai.y0Si0ncO.js"),[])]),{autoOpenAskAI:b,urlParams:m}=U.handleWidgetCallbackUrl();if(b&&U.cleanupCallbackUrl(),c.headerIconEnabled){const y=se(c.headerIconSelector);if(y){const W={appKey:t,appUrl:n,pageProductId:null,pageCollectionId:l,skills:r.skills,preloadedStyles:E,autoOpen:!1,urlParams:m,element:y,settings:c,agentImage:r.agentSettings.agentImage,hidePoweredBy:r.hidePoweredBy,brandLogo:r.brandSettings.brandLogo,chatModalSettings:r.chatModalSettings,customerId:o,headerIconMode:!0};f(g,v(O({},W),{widgetKey:K.ASK_AI,containerClasses:H,containerStyles:$,preloadedStyles:E})),y.setAttribute(F.STATUS,D.SUCCESS),console.log("AskAIController: Auto-injected header icon at",c.headerIconSelector)}}if(d){const y={appKey:t,appUrl:n,pageProductId:d,pageCollectionId:l,skills:r.skills,preloadedStyles:E,autoOpen:b,urlParams:m,element:e,settings:c,agentImage:r.agentSettings.agentImage,hidePoweredBy:r.hidePoweredBy,brandLogo:r.brandSettings.brandLogo,chatModalSettings:r.chatModalSettings,customerId:o,headerIconMode:!1};f(g,v(O({},y),{widgetKey:K.ASK_AI,containerClasses:H,containerStyles:$,preloadedStyles:E})),e.setAttribute(F.STATUS,D.SUCCESS)}}catch(t){console.error("Error initializing AskAIController",t),e.setAttribute(F.STATUS,D.FAILED),B("Error initializing AskAIController",t)}}),le=()=>C(void 0,null,function*(){if(console.log("AskAIController initGlobal (header icon)"),document.querySelector(".tolstoy-ask-ai, .ask-ai")){console.log("AskAIController initGlobal skipped - ask-ai element exists");return}if(!document.getElementById(x))try{yield a.init();const t=a.appKey,n=a.appUrl;if(!n||!t||a.aiShopperWidget&&a.aiShopperWidget!=="ask-ai")return;if(!a.askAIIconEnabled){console.log("AskAIController initGlobal skipped - Ask AI icon not enabled");return}const i=yield re.getAskAISettings({appKey:t,appUrl:n,productId:""}),{settings:l,shoppingAssistantConfig:o,enabled:d,compatibilityVersion:u}=i;if(u!=="v2"||!d||!l.headerIconEnabled||!(o!=null&&o.chatModalSettings))return;const{includeTemplates:c}=l,r=c==null?void 0:c.includes(a.templateName);if(c&&c.length>0&&!r&&!T.isPreviewSite())return;const p=se(l.headerIconSelector);if(!p)return;k(l.font),k(o.chatModalSettings.fontStyle);const[{default:A},{default:h},{default:_}]=yield Promise.all([S(()=>import("./a87087021/ask-ai-widget.D5EBFxEn.js"),[]),S(()=>import("./a87087021/render.utils.Difzk0UH.js").then(g=>g.a),[]),S(()=>import("./a87087021/ask-ai.y0Si0ncO.js"),[])]),{urlParams:I}=U.handleWidgetCallbackUrl(),s={appKey:t,appUrl:n,pageProductId:null,pageCollectionId:a.collectionId,skills:o.skills,preloadedStyles:_,autoOpen:!1,urlParams:I,element:p,settings:l,agentImage:o.agentSettings.agentImage,hidePoweredBy:o.hidePoweredBy,brandLogo:o.brandSettings.brandLogo,chatModalSettings:o.chatModalSettings,customerId:a.customerId,headerIconMode:!0};h(A,v(O({},s),{widgetKey:K.ASK_AI,containerClasses:H,containerStyles:$,preloadedStyles:_})),p.setAttribute(F.STATUS,D.SUCCESS),console.log("AskAIController: Global header icon injected")}catch(t){console.error("Error initializing AskAIController initGlobal",t),B("Error initializing AskAIController initGlobal",t)}}),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Fe,initGlobal:le},Symbol.toStringTag,{value:"Module"})),He={PRODUCT_TILE:{key:me.PRODUCT_TILE,controller:()=>S(()=>import("./a87087021/product-tiles-controller.B0G9C2cN.js"),[])},COLLECTION_PAGE_TILE:{key:Ee,controller:()=>S(()=>import("./a87087021/collection-page-tile-controller.CYjZxQGs.js"),[])},TOP_QUESTIONS:{key:"top-questions",controller:()=>S(()=>import("./a87087021/top-questions-controller.smvATIYR.js"),[])},SEE_IT_ON_YOU:{key:"see-it-on-you",controller:()=>S(()=>import("./a87087021/see-it-on-you-controller.bNLoQpCb.js"),[])},SEARCH_BAR:{key:"search-bar-widget",controller:()=>S(()=>Promise.resolve().then(()=>Ne),void 0)},SEARCH_BAR_INLINE:{key:"search-bar-inline",controller:()=>S(()=>import("./a87087021/search-bar-inline-controller.2MPuMncd.js"),[])},ASK_AI:{key:"ask-ai",controller:()=>S(()=>Promise.resolve().then(()=>Ke),void 0)},CHAT_EMBED:{key:"chat-embed",controller:()=>S(()=>import("./a87087021/chat-embed-controller.Cv1CkZNs.js"),[])},VIDEO_PAGE:{key:fe,controller:()=>S(()=>import("./a87087021/video-page-controller.DoVsUy0a.js").then(e=>e.V),[])},CHOOSE_MODEL:{key:"choose-model",controller:()=>S(()=>import("./a87087021/choose-model-controller.COTa3lxW.js"),[])}},$e={PRODUCT_GALLERY_VIDEO:{init:Re},SEARCH_BAR:{init:()=>z()},CHAT_BUBBLE:{init:()=>We()},ASK_AI_ICON:{init:()=>le()}},R=class R{constructor(){N(this,"subscribers");N(this,"eventsStatus");N(this,"handleMessage",t=>{const{detail:n}=t;if(n!=null&&n.eventName)switch(n.eventName){case V.ADD_TO_CART:case V.SPOTLIGHT_QUICK_SHOP:case V.PRODUCT_CARD_CLICK:this.subscribe(n.eventName,n.callback);break;default:this.notifySubscribers(n.eventName,n)}});this.subscribers=new Map,this.eventsStatus={[V.ADD_TO_CART]:!1,[V.SPOTLIGHT_QUICK_SHOP]:!1,[V.PRODUCT_CARD_CLICK]:!1}}static getInstance(){return R.instance||(R.instance=new R),R.instance}formatMessage(t){return v(O({},t),{transmissionId:t.transmissionId||"widget-v2",timestamp:Date.now()})}updateEventStatus(t,n){t in this.eventsStatus&&(this.eventsStatus[t]=n)}isEventSubscribed(t){return this.eventsStatus[t]||!1}notifySubscribers(t,n){const i=this.subscribers.get(t);i==null||i.forEach(l=>{try{l(n)}catch(o){console.error(`Error in ${t} callback:`,o)}})}subscribe(t,n){var i;this.subscribers.has(t)||this.subscribers.set(t,new Set),(i=this.subscribers.get(t))==null||i.add(n),this.updateEventStatus(t,!0)}unsubscribe(t,n){const i=this.subscribers.get(t);i==null||i.delete(n),(i==null?void 0:i.size)===0&&this.updateEventStatus(t,!1)}postMessage(t){const n=this.formatMessage(t),i=new CustomEvent(M.MESSAGE,{detail:n});window.dispatchEvent(i)}init(){window.addEventListener(M.SUBSCRIBE,this.handleMessage),window.addEventListener(M.MESSAGE,this.handleMessage);const t=new CustomEvent(M.SUBSCRIBE);window.addEventListener("tolstoyWidgetReady",()=>{window.dispatchEvent(t)},{once:!0})}destroy(){window.removeEventListener(M.SUBSCRIBE,this.handleMessage),window.removeEventListener(M.MESSAGE,this.handleMessage)}};N(R,"instance");let Q=R;const je=()=>{Q.getInstance().init()},ne=()=>C(void 0,null,function*(){try{je(),yield be(He,$e)}catch(e){B(e)}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{ne()}):ne();export{et as C,Q as E,ve as G,Je as P,H as S,at as T,nt as V,Ze as a,tt as b,X as c,$ as d,fe as e,ot as f,Ve as g,Pe as h,rt as i,Le as j,lt as k,it as l,st as m};
